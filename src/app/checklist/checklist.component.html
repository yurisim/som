<div
  class="fixed top-0 left-0 right-0 z-10 bg-white dark:bg-gray-800 shadow-md p-2 w-full box-border"
>
  <div class="container mx-auto">
    <!-- Progress info - stacks on mobile, side-by-side on larger screens -->
    <div class="flex flex-col sm:flex-row items-center justify-between">
      <div class="flex items-center w-full sm:max-w-md mb-2 sm:mb-0">
        <mat-progress-bar
          class="w-full"
          color="primary"
          mode="determinate"
          [value]="completionPercentage"
        >
        </mat-progress-bar>
      </div>
      <div class="flex justify-between w-full sm:w-auto sm:ml-4">
        <span class="font-medium"
          >{{ completionPercentage }}% Complete</span
        >
        <span class="ml-4"
          >{{ completedItems }} / {{ totalItems }} items</span
        >
      </div>
    </div>
  </div>
</div>

<div class="container mx-auto p-4 mt-20 max-w-full box-border">
  <mat-card class="mb-4" color="primary">
    <mat-card-header>
      <mat-card-title>Rules of Engagement (RoE)</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p class="">
        This checklist is a supplemental tool and does not replace the official
        Dormitory Standard Operating Procedure (SOP). Users must follow the
        actual Dorm SOP for complete guidance. Efforts will be made to keep this
        checklist up to date, but it is not a substitute for the official SOP.
        The official SOP will be released to you via Teams. 
      </p>
      <p class="">
        Your progress is saved on your local device and only you will be able to view it. 
      </p>
      <p class="mt-2"><strong>Current as of (CAO): 03 AUG 2025</strong></p>
      <p class="mt-2">Made by OT Sims 25-20</p>
    </mat-card-content>
  </mat-card>

  <div class="flex flex-wrap justify-end mb-4">
    <button mat-icon-button color="primary" (click)="clearAll()" aria-label="Clear all items">
      <mat-icon>remove_done</mat-icon>
    </button>
  </div>
  <mat-accordion multi togglePosition="before">
    <mat-expansion-panel *ngFor="let region of regions; trackBy: trackByRegion" class="mb-2" [expanded]="!isRegionComplete(region)">
      <mat-expansion-panel-header>
        <mat-panel-title class="text-lg sm:text-xl font-medium">
          {{ region }}
        </mat-panel-title>
        <mat-panel-description class="flex-grow justify-end items-center">
          ({{getCompletedItemsInRegion(region)}} / {{getTotalItemsInRegion(region)}})
          <div
            (click)="$event.stopPropagation()"
            (keydown.enter)="$event.stopPropagation()"
            tabindex="0"
            role="button"
            class="focus:outline-none"
          >
            <button
              mat-icon-button
              (click)="checkAllInRegion(region, true)"
              aria-label="Check all items in this region"
            >
              <mat-icon>done_all</mat-icon>
            </button>
            <button
              mat-icon-button
              color="primary"
              (click)="clearAllInRegion(region)"
              aria-label="Clear all items in this region"
            >
              <mat-icon>remove_done</mat-icon>
            </button>
          </div>
        </mat-panel-description>
      </mat-expansion-panel-header>
        <div *ngFor="let section of sections[region]" class="mb-4">
          <div class="flex justify-between items-center">
            <h3 class="mat-subheader text-base sm:text-lg font-medium break-words">
              {{ section }}
            </h3>
            <div
              *ngIf="groupedChecklist[region][section].length > 1"
              class="flex items-center"
            >
              <button
                mat-icon-button
                (click)="checkAllInSection(region, section, true)"
                aria-label="Check all items in this section"
              >
                <mat-icon>done_all</mat-icon>
              </button>
              <button
                mat-icon-button
                color="primary"
                (click)="clearAllInSection(region, section)"
                aria-label="Clear all items in this section"
              >
                <mat-icon>remove_done</mat-icon>
              </button>
            </div>
          </div>
          <div
            *ngFor="let item of groupedChecklist[region][section]"
            class="mb-1"
          >
            <div class="flex items-center">
              <mat-checkbox
                [(ngModel)]="item.checked"
                (ngModelChange)="onCheckboxChange($event, item.id)"
              ></mat-checkbox>
              <div
                class="ml-2 whitespace-normal  break-words cursor-pointer"
                (click)="item.checked = !item.checked; onCheckboxChange(item.checked, item.id)"
                (keydown.enter)="item.checked = !item.checked; onCheckboxChange(item.checked, item.id)"
                (keydown.space)="item.checked = !item.checked; onCheckboxChange(item.checked, item.id)"
                tabindex="0"
                role="checkbox"
                [attr.aria-checked]="item.checked"
              >
                {{ item.description }}
                <span class="text-gray-500 ml-1">
                  ({{ item.bullet }})
                </span>
              </div>
            </div>
          </div>
        </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>

<!-- Scroll to top FAB -->
<button 
  mat-fab 
  color="primary" 
  class="scroll-to-top"
  (click)="scrollToTop()"
  aria-label="Scroll to top"
>
  <mat-icon>arrow_upward</mat-icon>
</button>
